<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        background: #f0f0f0;
        text-align: center;
        font-family: Arial, Helvetica, sans-serif;
      }
      #device-1,
      #mode-1 {
        display: block;
        height: 55px;
        width: 120px;
        border: none;
        outline: none;
        border-radius: 50px;
        background: blue;
        transition: 0.9s;
        cursor: pointer;
      }
      #device-1.toggle,
      #mode-1.toggle {
        background: #a0a0a0;
        cursor: pointer;
      }
      #layout {
        margin: 0 auto;
        margin-top: 160px;
        display: grid;
        justify-content: center;
        grid-template-columns: 200px 200px;
      }
      #grid-left,
      #grid-right {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #device-1::before,
      #mode-1::before {
        box-shadow: 0 0 7px rgba(0, 0, 0, 0.4);
        display: inline-block;
        border-radius: 100%;
        background: white;
        margin-left: 60px;
        padding: 26px;
        content: "";
        transition: 0.6s;
        transform: scale(0.9);
      }
      #device-1.toggle::before,
      #mode-1.toggle::before {
        box-shadow: 0 0 7px rgba(0, 0, 0, 0.4);
        display: inline-block;
        border-radius: 100%;
        background: white;
        margin-left: -65px;
        padding: 26px;
        content: "";
      }
      #fan1,
      #fan2 {
        justify-self: center;
      }
      #fan1,
      #fan2,
      #temp1,
      #temp2 {
        align-self: center;
      }
      #temp1,
      #temp2 {
        font-size: 40pt;
      }
    </style>
  </head>
  <body>
    <div id="layout">
      <div id="fan1">
        <label for="device-1">KIPAS-1</label>
        <button id="device-1" class="toggle" onclick="btnState1()"></button>
      </div>
      <p id="temp1"></p>
      <div id="fan2">
        <label for="mode-1">Mode</label>
        <button id="mode-1" class="toggle" onclick="btnMode1()"></button>
      </div>
      <p id="temp2">
        13<sup>o</sup>C
      </p>
    </div>
    <script>
      var fan, temperature, mode;

      function updateData() {
        fetch("http://localhost:3000/data").then(res =>
          res.json().then(data => {
            fan = data.fan;
            mode = data.mode;
            document.getElementById("temp1").innerHTML =
              data.temp + "<sup>o</sup>C";
            let device = document.getElementById("device-1");
            let btnMode = document.getElementById("mode-1");

            if (fan == "OFF") device.classList.add("toggle");
            else device.classList.remove("toggle");

            if (mode == "auto") btnMode.classList.add("toggle");
            else btnMode.classList.remove("toggle");
          })
        );
      }
      function btnState1() {
        if (fan == "ON") fetch(`http://192.168.1.177/?fan=OFF&mode=manual`);
        else fetch(`http://192.168.1.177/?fan=ON&mode=manual`);
      }

      function btnMode1() {
        if (mode == "manual") fetch(`http://192.168.1.177/?fan=${fan}&mode=auto`);
        else fetch(`http://192.168.1.177/?fan=${fan}&mode=manual`);
      }

      setInterval("updateData()", 100);
    </script>
  </body>
</html>
